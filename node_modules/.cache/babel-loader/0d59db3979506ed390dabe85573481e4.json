{"remainingRequest":"/home/justin/Desktop/CICMS/node_modules/babel-loader/lib/index.js!/home/justin/Desktop/CICMS/node_modules/eslint-loader/index.js??ref--13-0!/home/justin/Desktop/CICMS/src/services/emotion.js","dependencies":[{"path":"/home/justin/Desktop/CICMS/src/services/emotion.js","mtime":1771824828470},{"path":"/home/justin/Desktop/CICMS/babel.config.js","mtime":1771823009049},{"path":"/home/justin/Desktop/CICMS/node_modules/cache-loader/dist/cjs.js","mtime":1771824225125},{"path":"/home/justin/Desktop/CICMS/node_modules/babel-loader/lib/index.js","mtime":1771824228601},{"path":"/home/justin/Desktop/CICMS/node_modules/eslint-loader/index.js","mtime":1771824225547}],"contextDependencies":[],"result":["/* global faceapi */\nimport store from '../store';\nclass EmotionService {\n  constructor() {\n    this.modelsLoaded = false;\n    this.stream = null;\n    this.video = null;\n    this.detectionInterval = null;\n    this.currentEmotion = 'neutral';\n\n    // Model URLs\n    this.MODEL_URL = 'https://raw.githubusercontent.com/justadudewhohacks/face-api.js/master/weights/';\n  }\n  async loadModels() {\n    if (this.modelsLoaded) return;\n    try {\n      console.log('[Emotion] Loading models...');\n      await Promise.all([faceapi.nets.tinyFaceDetector.loadFromUri(this.MODEL_URL), faceapi.nets.faceExpressionNet.loadFromUri(this.MODEL_URL)]);\n      this.modelsLoaded = true;\n      console.log('[Emotion] Models loaded');\n    } catch (err) {\n      console.error('[Emotion] Failed to load models:', err);\n    }\n  }\n  async startDetection() {\n    if (!this.modelsLoaded) await this.loadModels();\n    try {\n      this.stream = await navigator.mediaDevices.getUserMedia({\n        video: {}\n      });\n      this.video = document.createElement('video');\n      this.video.srcObject = this.stream;\n      this.video.play();\n      this.detectionInterval = setInterval(async () => {\n        const detections = await faceapi.detectSingleFace(this.video, new faceapi.TinyFaceDetectorOptions()).withFaceExpressions();\n        if (detections) {\n          const emotion = this.getTopEmotion(detections.expressions);\n          if (emotion !== this.currentEmotion) {\n            this.currentEmotion = emotion;\n            this.applyEmotionEffect(emotion);\n          }\n        }\n      }, 1000); // Detect every second\n    } catch (err) {\n      console.error('[Emotion] Camera access denied or error:', err);\n    }\n  }\n  getTopEmotion(expressions) {\n    let max = 0;\n    let topEmotion = 'neutral';\n    for (const [emotion, value] of Object.entries(expressions)) {\n      if (value > max) {\n        max = value;\n        topEmotion = emotion;\n      }\n    }\n    return topEmotion;\n  }\n  applyEmotionEffect(emotion) {\n    console.log('[Emotion] Detected:', emotion);\n    store.dispatch('chat/addActionLog', {\n      message: `Your character feels ${emotion}.`,\n      type: 'info'\n    });\n\n    // Example mechanics:\n    // happy: speed up\n    // angry: more damage\n    // sad: lower speed\n    // neutral: base stats\n\n    // We can emit an event or update store\n    store.commit('player/SET_EMOTION', emotion);\n  }\n  stop() {\n    if (this.detectionInterval) clearInterval(this.detectionInterval);\n    if (this.stream) {\n      this.stream.getTracks().forEach(track => track.stop());\n    }\n  }\n}\nexport const emotionService = new EmotionService();\nexport default emotionService;",{"version":3,"names":["store","EmotionService","constructor","modelsLoaded","stream","video","detectionInterval","currentEmotion","MODEL_URL","loadModels","console","log","Promise","all","faceapi","nets","tinyFaceDetector","loadFromUri","faceExpressionNet","err","error","startDetection","navigator","mediaDevices","getUserMedia","document","createElement","srcObject","play","setInterval","detections","detectSingleFace","TinyFaceDetectorOptions","withFaceExpressions","emotion","getTopEmotion","expressions","applyEmotionEffect","max","topEmotion","value","Object","entries","dispatch","message","type","commit","stop","clearInterval","getTracks","forEach","track","emotionService"],"sources":["/home/justin/Desktop/CICMS/src/services/emotion.js"],"sourcesContent":["/* global faceapi */\nimport store from '../store';\n\nclass EmotionService {\n    constructor() {\n        this.modelsLoaded = false;\n        this.stream = null;\n        this.video = null;\n        this.detectionInterval = null;\n        this.currentEmotion = 'neutral';\n\n        // Model URLs\n        this.MODEL_URL = 'https://raw.githubusercontent.com/justadudewhohacks/face-api.js/master/weights/';\n    }\n\n    async loadModels() {\n        if (this.modelsLoaded) return;\n        try {\n            console.log('[Emotion] Loading models...');\n            await Promise.all([\n                faceapi.nets.tinyFaceDetector.loadFromUri(this.MODEL_URL),\n                faceapi.nets.faceExpressionNet.loadFromUri(this.MODEL_URL)\n            ]);\n            this.modelsLoaded = true;\n            console.log('[Emotion] Models loaded');\n        } catch (err) {\n            console.error('[Emotion] Failed to load models:', err);\n        }\n    }\n\n    async startDetection() {\n        if (!this.modelsLoaded) await this.loadModels();\n\n        try {\n            this.stream = await navigator.mediaDevices.getUserMedia({ video: {} });\n            this.video = document.createElement('video');\n            this.video.srcObject = this.stream;\n            this.video.play();\n\n            this.detectionInterval = setInterval(async () => {\n                const detections = await faceapi.detectSingleFace(\n                    this.video,\n                    new faceapi.TinyFaceDetectorOptions()\n                ).withFaceExpressions();\n\n                if (detections) {\n                    const emotion = this.getTopEmotion(detections.expressions);\n                    if (emotion !== this.currentEmotion) {\n                        this.currentEmotion = emotion;\n                        this.applyEmotionEffect(emotion);\n                    }\n                }\n            }, 1000); // Detect every second\n        } catch (err) {\n            console.error('[Emotion] Camera access denied or error:', err);\n        }\n    }\n\n    getTopEmotion(expressions) {\n        let max = 0;\n        let topEmotion = 'neutral';\n        for (const [emotion, value] of Object.entries(expressions)) {\n            if (value > max) {\n                max = value;\n                topEmotion = emotion;\n            }\n        }\n        return topEmotion;\n    }\n\n    applyEmotionEffect(emotion) {\n        console.log('[Emotion] Detected:', emotion);\n        store.dispatch('chat/addActionLog', {\n            message: `Your character feels ${emotion}.`,\n            type: 'info'\n        });\n\n        // Example mechanics:\n        // happy: speed up\n        // angry: more damage\n        // sad: lower speed\n        // neutral: base stats\n\n        // We can emit an event or update store\n        store.commit('player/SET_EMOTION', emotion);\n    }\n\n    stop() {\n        if (this.detectionInterval) clearInterval(this.detectionInterval);\n        if (this.stream) {\n            this.stream.getTracks().forEach(track => track.stop());\n        }\n    }\n}\n\nexport const emotionService = new EmotionService();\nexport default emotionService;\n"],"mappings":"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","ignoreList":[]}]}